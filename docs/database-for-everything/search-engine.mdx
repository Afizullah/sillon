# Moteur de recherche

Certains produits auront peut-√™tre besoin d'un outil lourd comme [ElasticSearch](https://www.elastic.co/) pour stocker et optimiser les recherches √† effectuer, mais encore une fois, dans la grande majorit√© des cas [votre PostgreSQL suffira](https://www.postgresql.org/docs/current/textsearch.html).

Nous ne vous proposons quand m√™me pas de retourner √† l'op√©rateur SQL `LIKE %ma recherche%` üëµ, mais plut√¥t d'utiliser [les types de donn√©es `tsquery` et `tsvector`](https://www.postgresql.org/docs/current/datatype-textsearch.html). Si comme conseill√© vous utilisez l'ORM Prisma, l'utilisation est [assez facile et quasi transparente sur des colonnes distinctes](https://www.prisma.io/docs/concepts/components/prisma-client/full-text-search). Par contre cela ne marchera pas si vous cherchez "John Doe" et que "John" est dans la colonne `firstname` et "Doe" dans la colonne `lastname`.

Pour faire ce type de recherche sur plusieurs colonnes (exemple : le pr√©nom, le nom, l'adresse, la biographie), la strat√©gie est de [concat√©ner](https://fr.wiktionary.org/wiki/concat%C3%A9ner) chaque colonne voulue [dans une colonne g√©n√©r√©e](https://www.postgresql.org/docs/current/ddl-generated-columns.html) et index√©e, repr√©sentant un _tsvector_. Cette colonne est donc optimis√©e pour de la recherche.

[Prisma ne g√®re pas encore nativement les colonnes g√©n√©r√©es](https://github.com/prisma/prisma/issues/6336), mais rien ne vous emp√™che de la cr√©er √† la main. Diff√©rents articles existent sur internet mais pour vous donner une id√©e cela donnerait quelque chose comme :

```sql showLineNumbers
ALTER TABLE MyTable
ADD search TSVECTOR
GENERATED ALWAYS AS (
  to_tsvector('english',
    firstname || ' ' || lastname || ' ' || biography || ' ' || full_address
  )
) STORED;
```

Plut√¥t que de juste concat√©ner b√™tement les colonnes, on transforme le tout en `tsvector` afin qu'il soit d√©j√† optimis√© pour la recherche.

:::tip √Ä savoir
Un `tsvector` est optimis√© pour une langue en particulier afin de trier les mots. Par d√©faut, c'est la configuration `default_text_search_config` qui est utilis√©e. Sachez que m√™me si votre contenu est en fran√ßais, faites des tests avec `english` avant d'utiliser la valeur `french`. Cette derni√®re diff√©rencie les mots avec ou sans accent, ce qui peut √™tre probl√©matique‚Ä¶ N'h√©sitez pas √† jeter un ≈ìil √† [toutes les options de langues possibles](https://www.postgresql.org/docs/current/textsearch-psql.html).
:::
